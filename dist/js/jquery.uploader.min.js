/*!
 * jquery.uploader

 * Simple HTML5 file uploader
 * Copyright (c) 2017 Radoslav Salov
 * Distributed under MIT license
 * Portions of the project are licensed under Apache 2.0
 * Copyright for portions of the project are held by:
 * CreativeDream (c) 2016 ( https://github.com/CreativeDream/jQuery.filer )
 */

!function($){"use strict";$.fn.uploader=function(q){return this.each(function(t,r){var s=$(r),p=$(),o=$(),l=$(),sl=[],n_f=$.isFunction(q)?q(s,$.fn.uploader.defaults):q,n=n_f&&$.isPlainObject(n_f)?$.extend(!0,{},$.fn.uploader.defaults,n_f):$.fn.uploader.defaults,f={init:function(){s.wrap('<div class="uploader"></div>'),f._set("props"),s.prop("uploader").boxEl=p=s.closest(".uploader"),f._changeInput()},_bindInput:function(){n.changeInput&&o.length>0&&o.on("click",f._clickHandler),s.on({focus:function(){o.addClass("focused")},blur:function(){o.removeClass("focused")},change:f._onChange}),n.dragDrop&&(n.dragDrop.dragContainer.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),n.dragDrop.dragContainer.on("drop",f._dragDrop.drop),n.dragDrop.dragContainer.on("dragover",f._dragDrop.dragEnter),n.dragDrop.dragContainer.on("dragleave",f._dragDrop.dragLeave)),n.uploadFile&&n.clipBoardPaste&&$(window).on("paste",f._clipboardPaste)},_unbindInput:function(all){n.changeInput&&o.length>0&&o.off("click",f._clickHandler),all&&(s.off("change",f._onChange),n.dragDrop&&(n.dragDrop.dragContainer.off("drop",f._dragDrop.drop),n.dragDrop.dragContainer.off("dragover",f._dragDrop.dragEnter),n.dragDrop.dragContainer.off("dragleave",f._dragDrop.dragLeave)),n.uploadFile&&n.clipBoardPaste&&$(window).off("paste",f._clipboardPaste))},_clickHandler:function(){if(!n.uploadFile&&n.addMore&&0!=s.val().length){f._unbindInput(!0);var elem=$('<input type="file" />'),attributes=s.prop("attributes");$.each(attributes,function(){"required"!=this.name&&elem.attr(this.name,this.value)}),s.after(elem),sl.push(elem),s=elem,f._bindInput(),f._set("props")}s.click()},_applyAttrSettings:function(){var d=["name","limit","maxSize","fileMaxSize","extensions","changeInput","showThumbs","appendTo","theme","addMore","excludeName","files","uploadUrl","uploadData","options"];for(var k in d){var j="data-uploader-"+d[k];if(f._assets.hasAttr(j)){switch(d[k]){case"changeInput":case"showThumbs":case"addMore":n[d[k]]=["true","false"].indexOf(s.attr(j))>-1?"true"==s.attr(j):s.attr(j);break;case"extensions":n[d[k]]=s.attr(j).replace(/ /g,"").split(",");break;case"uploadUrl":n.uploadFile&&(n.uploadFile.url=s.attr(j));break;case"uploadData":n.uploadFile&&(n.uploadFile.data=JSON.parse(s.attr(j)));break;case"files":case"options":n[d[k]]=JSON.parse(s.attr(j));break;default:n[d[k]]=s.attr(j)}s.removeAttr(j)}}},_changeInput:function(){if(f._applyAttrSettings(),null!=n.beforeRender&&"function"==typeof n.beforeRender&&n.beforeRender(p,s),n.theme&&p.addClass("uploader-theme-"+n.theme),"input"!=s.get(0).tagName.toLowerCase()&&"file"!=s.get(0).type)o=s,(s=$('<input type="file" name="'+n.name+'" />')).css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"}),p.prepend(s),f._isGn=s;else if(n.changeInput){switch(typeof n.changeInput){case"boolean":o=$('<div class="uploader-input"><div class="uploader-input-caption"><span>'+n.captions.feedback+'</span></div><div class="uploader-input-button">'+n.captions.button+"</div></div>");break;case"string":case"object":o=$(n.changeInput);break;case"function":o=$(n.changeInput(p,s,n))}s.after(o),s.css({position:"absolute",left:"-9999px",top:"-9999px","z-index":"-9999"})}s.prop("uploader").newInputEl=o,n.dragDrop&&(n.dragDrop.dragContainer=n.dragDrop.dragContainer?$(n.dragDrop.dragContainer):o),(!n.limit||n.limit&&n.limit>=2)&&(s.attr("multiple","multiple"),"[]"!=s.attr("name").slice(-2)&&s.attr("name",s.attr("name")+"[]")),s.attr("disabled")||n.disabled?(n.disabled=!0,f._unbindInput(!0),p.addClass("uploader-disabled")):(n.disabled=!1,f._bindInput(),p.removeClass("uploader-disabled")),n.files&&f._append(!1,{files:n.files}),null!=n.afterRender&&"function"==typeof n.afterRender&&n.afterRender(l,p,o,s)},_clear:function(){f.files=null,s.prop("uploader").files=null,n.uploadFile||n.addMore||f._reset(),f._set("feedback",f._itFl&&f._itFl.length>0?f._itFl.length+" "+n.captions.feedback2:n.captions.feedback),null!=n.onEmpty&&"function"==typeof n.onEmpty&&n.onEmpty(p,o,s)},_reset:function(a){if(!a){if(!n.uploadFile&&n.addMore){for(var i=0;i<sl.length;i++)sl[i].remove();sl=[],f._unbindInput(!0),s=f._isGn?f._isGn:$(r),f._bindInput()}f._set("input","")}f._itFl=[],f._itFc=null,f._ajFc=0,f._set("props"),s.prop("uploader").files_list=f._itFl,s.prop("uploader").current_file=f._itFc,f._itFr=[],p.find("input[name^='uploader-items-exclude-']:hidden").remove(),l.fadeOut("fast",function(){$(this).remove()}),s.prop("uploader").listEl=l=$()},_set:function(element,value){switch(element){case"input":s.val(value);break;case"feedback":o.length>0&&o.find(".uploader-input-caption span").html(value);break;case"props":s.prop("uploader")||s.prop("uploader",{options:n,listEl:l,boxEl:p,newInputEl:o,inputEl:s,files:f.files,files_list:f._itFl,current_file:f._itFc,append:function(data){return f._append(!1,{files:[data]})},enable:function(){n.disabled&&(n.disabled=!1,s.removeAttr("disabled"),p.removeClass("uploader-disabled"),f._bindInput())},disable:function(){n.disabled||(n.disabled=!0,p.addClass("uploader-disabled"),f._unbindInput(!0))},remove:function(id){return f._remove(null,{binded:!0,data:{id:id}}),!0},reset:function(){return f._reset(),f._clear(),!0},retry:function(data){return f._retryUpload(data)}})}},_filesCheck:function(){var s=0;if(n.limit&&f.files.length+f._itFl.length>n.limit)return n.dialogs.alert(f._assets.textParse(n.captions.errors.filesLimit)),!1;for(var t=0;t<f.files.length;t++){var file=f.files[t],x=file.name.split(".").pop().toLowerCase(),m={name:file.name,size:file.size,size2:f._assets.bytesToSize(file.size),type:file.type,ext:x};if(null!=n.extensions&&-1==$.inArray(x,n.extensions)&&-1==$.inArray(m.type,n.extensions))return n.dialogs.alert(f._assets.textParse(n.captions.errors.filesType,m)),!1;if(null!=n.maxSize&&f.files[t].size>1048576*n.maxSize||null!=n.fileMaxSize&&f.files[t].size>1048576*n.fileMaxSize)return n.dialogs.alert(f._assets.textParse(n.captions.errors.filesSize,m)),!1;if(4096==file.size&&0==file.type.length)return n.dialogs.alert(f._assets.textParse(n.captions.errors.folderUpload,m)),!1;if(null!=n.onFileCheck&&"function"==typeof n.onFileCheck?!1===n.onFileCheck(m,n,f._assets.textParse):null)return!1;if((n.uploadFile||n.addMore)&&!n.allowDuplicates&&(m=f._itFl.filter(function(a,b){if(a.file.name==file.name&&a.file.size==file.size&&a.file.type==file.type&&(!file.lastModified||a.file.lastModified==file.lastModified))return!0})).length>0){if(1==f.files.length)return!1;file._pendRemove=!0}s+=f.files[t].size}return!(null!=n.maxSize&&s>=Math.round(1048576*n.maxSize))||(n.dialogs.alert(f._assets.textParse(n.captions.errors.filesSizeAll)),!1)},_thumbCreator:{create:function(i){var file=f.files[i],id=f._itFc?f._itFc.id:i,name=file.name,size=file.size,url=file.file,type=file.type?file.type.split("/",1):"".toString().toLowerCase(),ext=-1!=name.indexOf(".")?name.split(".").pop().toLowerCase():"",progressBar=n.uploadFile?'<div class="uploader-progress">'+n.templates.progressBar+"</div>":"",opts={id:id,name:name,size:size,size2:f._assets.bytesToSize(size),url:url,type:type,extension:ext,icon:f._assets.getIcon(ext,type),icon2:f._thumbCreator.generateIcon({type:type,extension:ext}),image:'<div class="uploader-item-thumb-image fi-loading"></div>',progressBar:progressBar,_appended:file._appended},html="";if(file.opts&&(opts=$.extend({},file.opts,opts)),html=$(f._thumbCreator.renderContent(opts)).attr("data-uploader-index",id),html.get(0).uploader_id=id,f._thumbCreator.renderFile(file,html,opts),file.forList)return html;f._itFc.html=html,html.hide()[n.templates.itemAppendToEnd?"appendTo":"prependTo"](l.find(n.templates._selectors.list)).show(),file._appended||f._onSelect(i)},renderContent:function(opts){return f._assets.textParse(opts._appended?n.templates.itemAppend:n.templates.item,opts)},renderFile:function(file,html,opts){if(0==html.find(".uploader-item-thumb-image").length)return!1;if(file.file&&"image"==opts.type){var g='<img src="'+file.file+'" draggable="false" />',m=html.find(".uploader-item-thumb-image.fi-loading");return $(g).error(function(){g=f._thumbCreator.generateIcon(opts),html.addClass("uploader-no-thumbnail"),m.removeClass("fi-loading").html(g)}).load(function(){m.removeClass("fi-loading").html(g)}),!0}if(window.File&&window.FileList&&window.FileReader&&"image"==opts.type&&opts.size<1e7){var y=new FileReader;y.onload=function(e){var m=html.find(".uploader-item-thumb-image.fi-loading");if(n.templates.canvasImage){var canvas=document.createElement("canvas"),context=canvas.getContext("2d"),img=new Image;img.onload=function(){var height=m.height(),width=m.width(),heightRatio=img.height/height,widthRatio=img.width/width,optimalRatio=heightRatio<widthRatio?heightRatio:widthRatio,optimalHeight=img.height/optimalRatio,optimalWidth=img.width/optimalRatio,steps=Math.ceil(Math.log(img.width/optimalWidth)/Math.log(2));if(canvas.height=height,canvas.width=width,img.width<canvas.width||img.height<canvas.height||steps<=1){var x=img.width<canvas.width?canvas.width/2-img.width/2:img.width>canvas.width?-(img.width-canvas.width)/2:0,y=img.height<canvas.height?canvas.height/2-img.height/2:0;context.drawImage(img,x,y,img.width,img.height)}else{var oc=document.createElement("canvas"),octx=oc.getContext("2d");oc.width=.5*img.width,oc.height=.5*img.height,octx.fillStyle="#fff",octx.fillRect(0,0,oc.width,oc.height),octx.drawImage(img,0,0,oc.width,oc.height),octx.drawImage(oc,0,0,.5*oc.width,.5*oc.height),context.drawImage(oc,optimalWidth>canvas.width?optimalWidth-canvas.width:0,0,.5*oc.width,.5*oc.height,0,0,optimalWidth,optimalHeight)}m.removeClass("fi-loading").html('<img src="'+canvas.toDataURL("image/png")+'" draggable="false" />')},img.onerror=function(){html.addClass("uploader-no-thumbnail"),m.removeClass("fi-loading").html(f._thumbCreator.generateIcon(opts))},img.src=e.target.result}else m.removeClass("fi-loading").html('<img src="'+e.target.result+'" draggable="false" />')},y.readAsDataURL(file)}else{var g=f._thumbCreator.generateIcon(opts),m=html.find(".uploader-item-thumb-image.fi-loading");html.addClass("uploader-no-thumbnail"),m.removeClass("fi-loading").html(g)}},generateIcon:function(obj){var m=new Array(3);if(obj&&obj.type&&obj.type[0]&&obj.extension)switch(obj.type[0]){case"image":m[0]="f-image",m[1]='<i class="icon-jfi-file-image"></i>';break;case"video":m[0]="f-video",m[1]='<i class="icon-jfi-file-video"></i>';break;case"audio":m[0]="f-audio",m[1]='<i class="icon-jfi-file-audio"></i>';break;default:m[0]="f-file f-file-ext-"+obj.extension,m[1]=obj.extension.length>0?"."+obj.extension:"",m[2]=1}else m[0]="f-file",m[1]=obj.extension&&obj.extension.length>0?"."+obj.extension:"",m[2]=1;var el='<span class="uploader-icon-file '+m[0]+'">'+m[1]+"</span>";if(1==m[2]&&f._assets.text2Color(obj.extension)){var j=$(el).appendTo("body");j.css("background-color",f._assets.text2Color(obj.extension)),el=j.prop("outerHTML"),j.remove()}return el},_box:function(params){if(null!=n.beforeShow&&"function"==typeof n.beforeShow&&!n.beforeShow(f.files,l,p,o,s))return!1;if(l.length<1){if(n.appendTo)appendTo=$(n.appendTo);else var appendTo=p;appendTo.find(".uploader-items").remove(),l=$('<div class="uploader-items uploader-row"></div>'),s.prop("uploader").listEl=l,l.append(f._assets.textParse(n.templates.box)).appendTo(appendTo),l.on("click",n.templates._selectors.remove,function(e){e.preventDefault();var m=[params?params.remove.event:e,params?params.remove.el:$(this).closest(n.templates._selectors.item)],c=function(a){f._remove(m[0],m[1])};n.templates.removeConfirmation?n.dialogs.confirm(n.captions.removeConfirmation,c):c()})}for(var i=0;i<f.files.length;i++)f.files[i]._appended||(f.files[i]._choosed=!0),f._addToMemory(i),f._thumbCreator.create(i)}},_upload:function(i){var c=f._itFl[i],el=c.html,formData=new FormData;if(formData.append(s.attr("name"),c.file,!!c.file.name&&c.file.name),null!=n.uploadFile.data&&$.isPlainObject("function"==typeof n.uploadFile.data?n.uploadFile.data(c.file):n.uploadFile.data))for(var k in n.uploadFile.data)formData.append(k,n.uploadFile.data[k]);f._ajax.send(el,formData,c)},_ajax:{send:function(el,formData,c){return c.ajax=$.ajax({url:n.uploadFile.url,data:formData,type:n.uploadFile.type,enctype:n.uploadFile.enctype,xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){f._ajax.progressHandling(e,el)},!1),myXhr},complete:function(jqXHR,textStatus){c.ajax=!1,f._ajFc++,n.uploadFile.synchron&&c.id+1<f._itFl.length&&f._upload(c.id+1),f._ajFc>=f.files.length&&(f._ajFc=0,s.get(0).value="",null!=n.uploadFile.onComplete&&"function"==typeof n.uploadFile.onComplete&&n.uploadFile.onComplete(l,p,o,s,jqXHR,textStatus))},beforeSend:function(jqXHR,settings){return null==n.uploadFile.beforeSend||"function"!=typeof n.uploadFile.beforeSend||n.uploadFile.beforeSend(el,l,p,o,s,c.id,jqXHR,settings)},success:function(data,textStatus,jqXHR){c.uploaded=!0,null!=n.uploadFile.success&&"function"==typeof n.uploadFile.success&&n.uploadFile.success(data,el,l,p,o,s,c.id,textStatus,jqXHR)},error:function(jqXHR,textStatus,errorThrown){c.uploaded=!1,null!=n.uploadFile.error&&"function"==typeof n.uploadFile.error&&n.uploadFile.error(el,l,p,o,s,c.id,jqXHR,textStatus,errorThrown)},statusCode:n.uploadFile.statusCode,cache:!1,contentType:!1,processData:!1}),c.ajax},progressHandling:function(e,el){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total).toString();null!=n.uploadFile.onProgress&&"function"==typeof n.uploadFile.onProgress&&n.uploadFile.onProgress(t,el,l,p,o,s),el.find(".uploader-progress").find(n.templates._selectors.progressBar).css("width",t+"%")}}},_dragDrop:{dragEnter:function(e){clearTimeout(f._dragDrop._drt),n.dragDrop.dragContainer.addClass("dragged"),f._set("feedback",n.captions.drop),null!=n.dragDrop.dragEnter&&"function"==typeof n.dragDrop.dragEnter&&n.dragDrop.dragEnter(e,o,s,p)},dragLeave:function(e){clearTimeout(f._dragDrop._drt),f._dragDrop._drt=setTimeout(function(e){if(!f._dragDrop._dragLeaveCheck(e))return f._dragDrop.dragLeave(e),!1;n.dragDrop.dragContainer.removeClass("dragged"),f._set("feedback",n.captions.feedback),null!=n.dragDrop.dragLeave&&"function"==typeof n.dragDrop.dragLeave&&n.dragDrop.dragLeave(e,o,s,p)},100,e)},drop:function(e){clearTimeout(f._dragDrop._drt),n.dragDrop.dragContainer.removeClass("dragged"),f._set("feedback",n.captions.feedback),e&&e.originalEvent&&e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&e.originalEvent.dataTransfer.files.length>0&&f._onChange(e,e.originalEvent.dataTransfer.files),null!=n.dragDrop.drop&&"function"==typeof n.dragDrop.drop&&n.dragDrop.drop(e.originalEvent.dataTransfer.files,e,o,s,p)},_dragLeaveCheck:function(e){var related=$(e.currentTarget);return!(!related.is(o)&&o.find(related).length>0)}},_clipboardPaste:function(e,fromDrop){if((fromDrop||e.originalEvent.clipboardData||e.originalEvent.clipboardData.items)&&(!fromDrop||e.originalEvent.dataTransfer||e.originalEvent.dataTransfer.items)&&!f._clPsePre){var items=fromDrop?e.originalEvent.dataTransfer.items:e.originalEvent.clipboardData.items;if(items)for(var i=0;i<items.length;i++)if(-1!==items[i].type.indexOf("image")||-1!==items[i].type.indexOf("text/uri-list")){if(fromDrop)try{window.atob(e.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1])}catch(e){return}var blob=fromDrop?function(b64Data,contentType,sliceSize){contentType=contentType||"",sliceSize=sliceSize||512;for(var byteCharacters=atob(b64Data),byteArrays=[],offset=0;offset<byteCharacters.length;offset+=sliceSize){for(var slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length),i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:contentType})}(e.originalEvent.dataTransfer.getData("text/uri-list").toString().split(",")[1],"image/png"):items[i].getAsFile();blob.name=Math.random().toString(36).substring(5),blob.name+=-1!=blob.type.indexOf("/")?"."+blob.type.split("/")[1].toString().toLowerCase():".png",f._onChange(e,[blob]),f._clPsePre=setTimeout(function(){delete f._clPsePre},1e3)}}},_onSelect:function(i){n.uploadFile&&!$.isEmptyObject(n.uploadFile)&&(!n.uploadFile.synchron||n.uploadFile.synchron&&0==$.grep(f._itFl,function(a){return a.ajax}).length)&&f._upload(f._itFc.id),f.files[i]._pendRemove&&(f._itFc.html.hide(),f._remove(null,{binded:!0,data:{id:f._itFc.id}})),null!=n.onSelect&&"function"==typeof n.onSelect&&n.onSelect(f.files[i],f._itFc.html,l,p,o,s),i+1>=f.files.length&&null!=n.afterShow&&"function"==typeof n.afterShow&&n.afterShow(l,p,o,s)},_onChange:function(e,d){if(d){if(!d||0==d.length)return f._set("input",""),f._clear(),!1;f.files=d}else{if(!s.get(0).files||void 0===s.get(0).files||0==s.get(0).files.length)return n.uploadFile||n.addMore||(f._set("input",""),f._clear()),!1;f.files=s.get(0).files}if(n.uploadFile||n.addMore||f._reset(!0),s.prop("uploader").files=f.files,!f._filesCheck()||null!=n.beforeSelect&&"function"==typeof n.beforeSelect&&!n.beforeSelect(f.files,l,p,o,s))return f._set("input",""),f._clear(),n.addMore&&sl.length>0&&(f._unbindInput(!0),sl[sl.length-1].remove(),sl.splice(sl.length-1,1),s=sl.length>0?sl[sl.length-1]:$(r),f._bindInput()),!1;if(f._set("feedback",f.files.length+f._itFl.length+" "+n.captions.feedback2),n.showThumbs)f._thumbCreator._box();else for(var i=0;i<f.files.length;i++)f.files[i]._choosed=!0,f._addToMemory(i),f._onSelect(i)},_append:function(e,data){var files=!!data&&data.files;if(files&&!(files.length<=0)&&(f.files=files,s.prop("uploader").files=f.files,n.showThumbs)){for(var i=0;i<f.files.length;i++)f.files[i]._appended=!0;f._thumbCreator._box()}},_getList:function(e,data){var files=!!data&&data.files;if(files&&!(files.length<=0)&&(f.files=files,s.prop("uploader").files=f.files,n.showThumbs)){for(var returnData=[],i=0;i<f.files.length;i++)f.files[i].forList=!0,returnData.push(f._thumbCreator.create(i));data.callback&&data.callback(returnData,l,p,o,s)}},_retryUpload:function(e,data){var id=parseInt("object"==typeof data?data.attr("data-uploader-index"):data),obj=f._itFl.filter(function(value,key){return value.id==id});return obj.length>0&&(!n.uploadFile||$.isEmptyObject(n.uploadFile)||obj[0].uploaded?void 0:(f._itFc=obj[0],s.prop("uploader").current_file=f._itFc,f._upload(id),!0))},_remove:function(e,el){if(el.binded){if(void 0!==el.data.id&&0==(el=l.find(n.templates._selectors.item+"[data-uploader-index='"+el.data.id+"']")).length)return!1;el.data.el&&(el=el.data.el)}var excl_input=function(val){var input=p.find("input[name^='uploader-items-exclude-']:hidden").first();0==input.length&&(input=$('<input type="hidden" name="uploader-items-exclude-'+(n.excludeName?n.excludeName:("[]"!=s.attr("name").slice(-2)?s.attr("name"):s.attr("name").substring(0,s.attr("name").length-2))+"-"+t)+'">')).appendTo(p),val&&$.isArray(val)&&(val=JSON.stringify(val),input.val(val))},callback=function(el,id){var item=f._itFl[id],val=[];if(item.file._choosed||item.file._appended||item.uploaded){f._itFr.push(item);for(var m=f._itFl.filter(function(a){return a.file.name==item.file.name}),i=0;i<f._itFr.length;i++)n.addMore&&f._itFr[i]==item&&m.length>0&&(f._itFr[i].remove_name=m.indexOf(item)+"://"+f._itFr[i].file.name),val.push(f._itFr[i].remove_name?f._itFr[i].remove_name:f._itFr[i].file.name)}excl_input(val),f._itFl.splice(id,1),f._itFl.length<1?(f._reset(),f._clear()):f._set("feedback",f._itFl.length+" "+n.captions.feedback2),el.fadeOut("fast",function(){$(this).remove()})},attrId=el.get(0).uploader_id||el.attr("data-uploader-index"),id=null;for(var key in f._itFl)"length"!==key&&f._itFl.hasOwnProperty(key)&&f._itFl[key].id==attrId&&(id=key);return!!f._itFl.hasOwnProperty(id)&&(f._itFl[id].ajax?(f._itFl[id].ajax.abort(),void callback(el,id)):void(null!=n.onRemove&&"function"==typeof n.onRemove&&!1===n.onRemove(el,f._itFl[id].file,id,l,p,o,s)||callback(el,id)))},_addToMemory:function(i){f._itFl.push({id:f._itFl.length,file:f.files[i],html:$(),ajax:!1,uploaded:!1}),(n.addMore||f.files[i]._appended)&&(f._itFl[f._itFl.length-1].input=s),f._itFc=f._itFl[f._itFl.length-1],s.prop("uploader").files_list=f._itFl,s.prop("uploader").current_file=f._itFc},_assets:{bytesToSize:function(bytes){if(0==bytes)return"0 Byte";var sizes=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(bytes)/Math.log(1e3));return(bytes/Math.pow(1e3,i)).toPrecision(3)+" "+sizes[i]},hasAttr:function(attr,el){var a=(el=el||s).attr(attr);return!(!a||void 0===a)},getIcon:function(ext,type){var types=["audio","image","text","video"];return $.inArray(type,types)>-1?'<i class="icon-jfi-file-'+type+" jfi-file-ext-"+ext+'"></i>':'<i class="icon-jfi-file-o jfi-file-type-'+type+" jfi-file-ext-"+ext+'"></i>'},textParse:function(text,opts){switch(opts=$.extend({},{limit:n.limit,maxSize:n.maxSize,fileMaxSize:n.fileMaxSize,extensions:n.extensions?n.extensions.join(","):null},opts&&$.isPlainObject(opts)?opts:{},n.options),typeof text){case"string":return text.replace(/\{\{fi-(.*?)\}\}/g,function(match,a){return a=a.replace(/ /g,""),a.match(/(.*?)\|limitTo\:(\d+)/)?a.replace(/(.*?)\|limitTo\:(\d+)/,function(match,a,b){var str=(a=opts[a]?opts[a]:"").substring(0,b);return str=a.length>str.length?str.substring(0,str.length-3)+"...":str}):opts[a]?opts[a]:""});case"function":return text(opts);default:return text}},text2Color:function(str){if(!str||0==str.length)return!1;for(var i=0,hash=0;i<str.length;hash=str.charCodeAt(i++)+((hash<<5)-hash));for(var i=0,colour="#";i<3;colour+=("00"+(hash>>2*i++&255).toString(16)).slice(-2));return colour}},files:null,_itFl:[],_itFc:null,_itFr:[],_itPl:[],_ajFc:0};return s.on("uploader.append",function(e,data){f._append(e,data)}).on("uploader.remove",function(e,data){data.binded=!0,f._remove(e,data)}).on("uploader.reset",function(e){return f._reset(),f._clear(),!0}).on("uploader.generateList",function(e,data){return f._getList(e,data)}).on("uploader.retry",function(e,data){return f._retryUpload(e,data)}),f.init(),this})},$.fn.uploader.defaults={limit:null,maxSize:null,fileMaxSize:null,extensions:null,changeInput:!0,showThumbs:!1,appendTo:null,theme:"default",templates:{box:'<ul class="uploader-items-list uploader-items-default"></ul>',item:'<li class="uploader-item"><div class="uploader-item-container"><div class="uploader-item-inner"><div class="uploader-item-icon pull-left">{{fi-icon}}</div><div class="uploader-item-info pull-left"><div class="uploader-item-title" title="{{fi-name}}">{{fi-name | limitTo:30}}</div><div class="uploader-item-others"><span>size: {{fi-size2}}</span><span>type: {{fi-extension}}</span><span class="uploader-item-status">{{fi-progressBar}}</span></div><div class="uploader-item-assets"><ul class="list-inline"><li><a class="icon-jfi-trash uploader-item-trash-action"></a></li></ul></div></div></div></div></li>',itemAppend:'<li class="uploader-item"><div class="uploader-item-container"><div class="uploader-item-inner"><div class="uploader-item-icon pull-left">{{fi-icon}}</div><div class="uploader-item-info pull-left"><div class="uploader-item-title">{{fi-name | limitTo:35}}</div><div class="uploader-item-others"><span>size: {{fi-size2}}</span><span>type: {{fi-extension}}</span><span class="uploader-item-status"></span></div><div class="uploader-item-assets"><ul class="list-inline"><li><a class="icon-jfi-trash uploader-item-trash-action"></a></li></ul></div></div></div></div></li>',progressBar:'<div class="bar"></div>',itemAppendToEnd:!1,removeConfirmation:!0,canvasImage:!0,_selectors:{list:".uploader-items-list",item:".uploader-item",progressBar:".bar",remove:".uploader-item-trash-action"}},files:null,uploadFile:null,dragDrop:null,addMore:!1,allowDuplicates:!1,clipBoardPaste:!0,excludeName:null,beforeRender:null,afterRender:null,beforeShow:null,beforeSelect:null,onSelect:null,onFileCheck:null,afterShow:null,onRemove:null,onEmpty:null,options:null,dialogs:{alert:function(text){return alert(text)},confirm:function(text,callback){confirm(text)&&callback()}},captions:{button:"Choose Files",feedback:"Choose files To Upload",feedback2:"files were chosen",drop:"Drop file here to Upload",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only {{fi-limit}} files are allowed to be uploaded.",filesType:"Only Images are allowed to be uploaded.",filesSize:"{{fi-name}} is too large! Please upload file up to {{fi-fileMaxSize}} MB.",filesSizeAll:"Files you've choosed are too large! Please upload files up to {{fi-maxSize}} MB.",folderUpload:"You are not allowed to upload folders."}}}}(jQuery);